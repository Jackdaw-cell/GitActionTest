name: MY Action Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]
jobs:
  publish:
    # æŒ‡å®šçŽ¯å¢ƒ, å³åˆ›å»ºçŽ¯å¢ƒæœºå¯†æ—¶, ç»™çŽ¯å¢ƒçš„å‘½å. å½“ç„¶å¦‚æžœä½ åˆ›å»ºçš„æ˜¯ä»“åº“æœºå¯†, åˆ™æ— éœ€ä¸‹é¢è¿™è¡Œ
    environment: deploy to tencent
    # æŒ‡å®šåœ¨Ubuntuæœºå™¨ä¸Šè¿è¡Œæ­¤å·¥ä½œæµ
    runs-on: [self-hosted, linux]
    env:
      # ç§é’¥
      SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
      # ç”¨æˆ·å
      SSH_USERNAME: ${{ secrets.SSH_USERNAME }}
      # ä¸»æœºåœ°å€
      SSH_HOST: ${{ secrets.SSH_HOST }}
      # æŒ‡çº¹
      SSH_KNOWN_HOST: ${{ secrets.SSH_KNOWN_HOST }}
 steps:
      # åˆ›å»ºsshç›®å½•, å¹¶å¯åŠ¨sshä»£ç†
      - name: setup ssh
        shell: bash
        run: |
          mkdir -p $HOME/.ssh
      # ä¿å­˜å…¬é’¥åˆ°known_hosts
      - name: configure ssh public key
        shell: bash
        run: echo "$SSH_KNOWN_HOSTS" > ~/.ssh/known_hosts
      # ä¿å­˜ç§é’¥åˆ°ssh-agent
      - name: setup ssh private key
        shell: bash
        run: |
          # å¯åŠ¨ssh-agent
          eval $(ssh-agent)
          # å°†è¿›ç¨‹ä¿¡æ¯ä¿å­˜åˆ°çŽ¯å¢ƒå˜é‡, æ–¹ä¾¿åŽé¢çš„ç¨‹åºä½¿ç”¨, å¦‚docker
          echo "SSH_AUTH_SOCK=$SSH_AUTH_SOCK" >> $GITHUB_ENV
          echo "SSH_AGENT_PID=SSH_AGENT_PID" >> $GITHUB_ENV
          # å°†å¯†é’¥æ·»åŠ çš„ssh-agent
          echo "$SSH_PRIVATE_KEY" | ssh-add -
      # åˆ›å»ºå¹¶ä½¿ç”¨dockerè¿œç¨‹ä¸Šä¸‹æ–‡
      - name: create and use docker remote context
        shell: bash
        run: |
          systemctl status nginx

     
